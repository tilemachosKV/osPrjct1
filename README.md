# osPrjct1

# 🏛️ Αρχιτεκτονική Συστήματος

Το σύστημα βασίζεται σε ένα μοντέλο επικοινωνίας πολλών διεργασιών (Inter-Process Communication - IPC) που χρησιμοποιεί τους παρακάτω πυλώνες:

## 1. Μοντέλο Εκτέλεσης
Η εφαρμογή αποτελείται από πολλαπλές, ανεξάρτητες **Διεργασίες (Processes)**.

## 2. Εκκίνηση & Ρόλοι
Ο χρήστης εκκινεί κάθε διεργασία χειροκίνητα από τη γραμμή εντολών. Οι διεργασίες αναγνωρίζουν τον ρόλο τους μέσω παραμέτρων (flags):

* **Αρχικοποιητής (`-i`):** Η πρώτη διεργασία που εκκινείται (π.χ. `./chat -i -k key`) είναι υπεύθυνη για τη **δημιουργία** της διαμοιραζόμενης μνήμης και των δομών συγχρονισμού.
* **Συμμετέχων (`-a`):** Κάθε επόμενη διεργασία (π.χ. `./chat -a -k key`) απλώς **συνδέεται (attach)** στους ήδη υπάρχοντες πόρους.

## 3. Μέσο Επικοινωνίας
Χρησιμοποιείται **μία (1) ενιαία περιοχή Διαμοιραζόμενης Μνήμης (SHM)**, η οποία φιλοξενεί *όλους* τους ενεργούς διαλόγους ταυτόχρονα.

## 4. Ταυτόχρονη Λειτουργία
Για να επιτευχθεί η ταυτόχρονη αποστολή/λήψη, κάθε **διεργασία** θα δημιουργεί εσωτερικά **Νήματα (Threads)** (π.χ. ένα για την αναμονή εισόδου από τον χρήστη και ένα για την παρακολούθηση νέων μηνυμάτων στην SHM).

## 5. Τερματισμός Διαλόγου
Η αποστολή του μηνύματος `TERMINATE` προκαλεί τον τερματισμό *όλων* των διεργασιών που συμμετέχουν *στον συγκεκριμένο διάλογο* (αποστολέας και παραλήπτες).

## 6. Εκκαθάριση Πόρων
Ένας **κεντρικός μετρητής ενεργών διαλόγων** θα διατηρείται μέσα στην SHM. Η διεργασία που αποστέλλει το `TERMINATE` στον *τελευταίο* ενεργό διάλογο είναι υπεύθυνη για τον καθαρισμό και την αποδέσμευση της διαμοιραζόμενης μνήμης και των πόρων συγχρονισμού.

## 7. Συγχρονισμός
Η ασφαλής ταυτόχρονη πρόσβαση στην SHM (π.χ. στον μετρητή διαλόγων, στις εγγραφές μηνυμάτων) θα διασφαλιστεί με κατάλληλους μηχανισμούς συγχρονισμού, όπως οι **Σημαφόροι (Semaphores)**.

---

# 🐞 Έλεγχος & Debugging

Η αποσφαλμάτωση συστημάτων IPC (Inter-Process Communication) απαιτεί έναν συνδυασμό εργαλείων για τον έλεγχο τόσο των πόρων του συστήματος όσο και της εσωτερικής λογικής των διεργασιών.

## 1. Έλεγχος Πόρων Συστήματος (ipcs / ipcrm)

Αυτά τα εργαλεία ελέγχουν τους πόρους IPC (Shared Memory, Semaphores) που διαχειρίζεται το Λειτουργικό Σύστημα.

### `ipcs`: Έλεγχος Ενεργών Πόρων

* **Έλεγχος Διαμοιραζόμενης Μνήμης (SHM):**
    ```bash
    ipcs -m
    ```
    Αναζητήστε το **key** που χρησιμοποιήσατε και το **nattch** (πόσες διεργασίες είναι συνδεδεμένες).

* **Έλεγχος Σημαφόρων (Semaphores):**
    ```bash
    ipcs -s
    ```
    Επιβεβαιώνει ότι οι σημαφόροι σας δημιουργήθηκαν σωστά.

### `ipcrm`: Χειροκίνητος Καθαρισμός

**⚠️ Σημαντικό:** Αν το πρόγραμμά σας "κρασάρει", οι πόροι μένουν "ορφανοί". Πρέπει να τους καθαρίσετε χειροκίνητα πριν την επόμενη εκτέλεση.

* **Καθαρισμός Μνήμης** (χρησιμοποιήστε το `shmid` από την `ipcs -m`):
    ```bash
    ipcrm -m <shmid>
    ```

* **Καθαρισμός Σημαφόρων** (χρησιμοποιή Kα το `semid` από την `ipcs -s`):
    ```bash
    ipcrm -s <semid>
    ```

## 2. Έλεγχος Private Μνήμης & Leaks (Valgrind Memcheck)

Το `Valgrind Memcheck` (το default εργαλείο του Valgrind) ελέγχει την ιδιωτική μνήμη (private heap) της κάθε διεργασίας.

**Τι Βρίσκει:**
* **Memory Leaks:** `malloc` που δεν αντιστοιχίστηκαν με `free`.
* **Invalid Access:** Προσπάθεια εγγραφής/ανάγνωσης εκτός ορίων (π.χ. buffer overflow).
* **Use After Free:** Χρήση δείκτη αφού έχει γίνει `free`.

**Χρήση:**
Τρέξτε το πρόγραμμά σας *μέσω* του Valgrind:
```bash
valgrind --leak-check=full ./chat -a -k 1234